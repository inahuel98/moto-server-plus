{% extends "base.html" %}

{% block scripts %}
<script>
    function startDownload(tipo) {
        var url = document.getElementById('url').value;
        if(!url) { alert("Â¡Falta el Link!"); return false; }
        document.getElementById('tipo_input').value = tipo;
        document.getElementById('form-box').style.display = 'none';
        document.getElementById('loader-box').style.display = 'block';
        document.getElementById('status-msg').innerText = (tipo === 'audio') ? "Procesando Audio..." : "Descargando Video...";
        document.getElementById('main-form').submit();
    }
</script>
{% endblock %}

{% block content %}
    <div id="form-box">
        <form id="main-form" method="POST" action="/procesar">
            <input type="text" id="url" name="url" placeholder="Pegar enlace..." required autocomplete="off">
            <input type="hidden" id="tipo_input" name="tipo" value="video">
            <div class="btn-group">
                <button type="button" class="btn btn-video" onclick="startDownload('video')">VIDEO</button>
                <button type="button" class="btn btn-audio" onclick="startDownload('audio')">AUDIO</button>
            </div>
        </form>
    </div>

    <div id="loader-box" class="loader-box" style="display:none;">
        <div class="spinner"></div>
        <h3 id="status-msg">Procesando...</h3>
    </div>

    <div class="gallery-grid">
        {% for archivo in lista_archivos %}
            <div class="file-card">
                <div class="icon">{{ archivo.icono }}</div>
                <span class="file-name">{{ archivo.nombre }}</span>
                <span class="file-meta">{{ archivo.tamano }} {{ archivo.fecha }}</span>
                <div class="card-actions">
                    <a href="{{ url_for('main.view_file', filename=archivo.nombre) }}" target="_blank" class="btn-mini btn-play">Ver</a>
                    <a href="{{ url_for('main.download_file', filename=archivo.nombre) }}" class="btn-mini btn-dl">Bajar</a>
                </div>
            </div>
        {% endfor %}
    </div>
{% endblock %}